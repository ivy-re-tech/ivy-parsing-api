# Ivy Parsing API

This is an API wrapper around two of Datamade's parsing packages:
 
* [probablepeople](https://github.com/datamade/probablepeople)
* [usaddress](https://github.com/datamade/usaddress)

It's built on [FastAPI](https://fastapi.tiangolo.com) - a modern, fast (high-performance), web framework.

### Install

To run the service, you can call it directly from the terminal!

```
python main.py
```

For your convenience, or to deploy it alongside other services, you can use [Docker](https://docs.docker.com/install/) and [docker-compose](https://docs.docker.com/compose/install/).

```
# prod
docker-compose up

# debug
SP_DEBUG=yes docker-compose up
```

### Use

There are four endpoints:
* `GET /` - Healthcheck - returns `"pong""`.
* `GET /docs` - Autogenerated documentation in Swagger UI.
* `GET /address/<str>` - Split an address string into a dictionary of components.
* `GET /name/<str>` - Return an object representing the parsed name and any errors.

### Test

Some minor testing can be done with the tests in `test/test_address.py`.
You can also manually test with the `test/localhost_parse_requests.http` request library.

### Build/Deploy

1) Modify image tag in `docker-compose.yml` to new version
2) `docker-compose build`
3) Ensure you have permission to push to gcr: `gcloud auth configure-docker`
4) `docker push <image>`
5) Modify `deploy/IvyParser.yml` to new image version
6) run `kubectl apply -f deploy/IvyParser.yml`

### Contribute

We welcome your contributions! Areas we need help:

1. Tests
2. Logging optimization and visibility from Docker

Also feel free to post Issues - that's also helpful!

### License

This software is available for free under the [GPL 3.0](https://opensource.org/licenses/GPL-3.0).
